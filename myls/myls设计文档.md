#### myls设计文档

**设计思想**

本设计的基本思想为解析、迭代，输出。根据ls的不同选项实现不同的输出功能。利用全局变量记录参数选项。通过对不同全局变量的判定来输出对应的内容。程序的主要输出为两部分内容，分别为目录输出和文件输出，其中目录输出在一定程度上依赖于文件输出。程序本身总体来讲并无难点，但由于设计过程的时间限制，以及总体框架设计的不合理，导致ls命令的组合功能和排序显示功能并未完全实现，且在目前的设计框架下较难改正。本次设计主要是基于实现基本功能上，目的是体现ls命令强大的目录文件信息显示能力，从而加深对于这一Linux下最常用的工具的理解。

**数据结构与算法**

<img src="C:\Users\Dell\AppData\Roaming\Typora\typora-user-images\image-20200815184629605.png" alt="image-20200815184629605" style="zoom:67%;" />

定义一个文件排序结构，以及对应的的全局变量，该结构存储文件大小，时间，以及名字。可以在ls -t，ls -u，ls -S命令中得以使用，通过存储其对应的值，来实现显示。在数据的适应屏幕显示(未完全整合-已删除)中使用了队列与动态规划。命令解析中使用了两重循环判定与case语句，整个代码使用了大量的if语句实现不同情况的判定。

**已实现功能**

一共实现了22个选项。ls -a 显示包括隐藏文件和'.','..'文件。2. ls -l 长列表显示文件。3. ls -i 文件名前输出inode值。4. ls -d 将目录按文件格式显示而不展开。 5. ls -c根据change时间排序文件显示。6. ls -f 显示包括隐藏文件且不排序。7. ls -1换行显示文件。8. ls -o 输出详细信息除去group。9. ls -B 输出不以~结尾的备份文件。10. ls -N 输出不限制文件长度。11. ls -S 按照文件大小排序。12. ls -g 输出文件详细信息出去owner。13. ls -A 输出包括隐藏文件。14. ls -u 按上次访问时间排序。15. ls -r 反向排序输出。16. ls -Q用双引号括起输出。17. ls -m 逗号分割输出文件。18. ls -R 递归输出文件。19. ls -n 长列表显示，使用UID与GID。20. ls -t 按照文件修改时间排序。21. ls -F 对不同类型文件加以区分显示。22. ls -s 输出每个文件的分配大小。i

同时所有统计信息的total(分配的ls block的大小)也能够显示。

组合选项

ls -al，ls -an，ls -ao, ls -ag, ls -Al, ls -An, ls -Ao, ls -Ag,  ls -a1,ls -A1, ls -ai, ls -Ai,等一系列a和A选项与其他的组合。

ls -Rl, ls -Rn, ls -Ro, ls -Rg, ls -Ri,等一系列R选项与其他的组合。

主要没实现的组合功能就是时间排序这一部分。这部分难度不大，但对空间的要求比较高，且不易兼容，故省去了。

 **不足之处**

限于能力与时间，本项目还是有很大的不足之处的。1. 普通的ls命令未实现字典序排序，比如ls -a, ls -l这类，为了程序的兼容性将其舍弃，增加并不困难。此代码我用C++改写后十分精简，但效率不够。 2. ls命令的一些组合功能，以及无法相互组合的命令之间的优先级关系判断。3. ls 的某些选项的输出细节存在一些问题。4. ls命令的适应屏幕显示。其实不同的系统ls的显示格式也都不一样，有时候很难统一，自己有一台MAC，还有实验室的一台Ubuntu服务器，方言挺多的。同时，程序编译的时候，一些整形的不同形式的输出在不同平台上可能会有一些warning。

